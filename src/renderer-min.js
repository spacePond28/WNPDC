let folderCounter=0;function addFolder(e="New Folder",t=null){const r=t||document.getElementById("folderStructure"),n=`folder-${Date.now()}-${folderCounter++}`,l=document.createElement("div");return l.className="accordion-item",l.innerHTML=`\n        <h2 class="accordion-header" id="heading-${n}">\n            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${n}" aria-expanded="false" aria-controls="collapse-${n}">\n                üìÅ <span class="folder-name" contenteditable="true" onkeydown="handleFolderNameEdit(event)">${e}</span>\n            </button>\n        </h2>\n        <div id="collapse-${n}" class="accordion-collapse collapse" aria-labelledby="heading-${n}">\n            <div class="accordion-body nested"></div>\n        </div>\n    `,r.appendChild(l),makeSortable(l.querySelector(".nested")),l}function handleFolderNameEdit(e){"Enter"===e.key&&(e.preventDefault(),e.target.blur())}function getFolderStructure(e=document.getElementById("folderStructure")){return Array.from(e.children).map((e=>e.classList.contains("file-item")?{name:e.querySelector(".file-name").innerText,path:e.dataset.filePath}:{name:e.querySelector(".folder-name").innerText,subFolders:getFolderStructure(e.querySelector(".nested"))}))}function exportToFile(){const e=convertStructureToText(getFolderStructure()),t=new Blob([e],{type:"text/plain"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="folder_structure.txt",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function convertStructureToText(e,t=1){return e.map((e=>{const r="-".repeat(t);return e.path?`${r}${e.name} [File: ${e.path}]\n`:`${r}${e.name}\n${convertStructureToText(e.subFolders,t+1)}`})).join("")}function addFolderStructure(e,t=null){const r=t?t.querySelector(".nested"):document.getElementById("folderStructure");if(r)if(e.path){addFile({directoryPath:e.path.substring(0,e.path.lastIndexOf("\\")),fileName:e.path.substring(e.path.lastIndexOf("\\")+1)},r)}else{const t=addFolder(e.name,r);e.subFolders.forEach((e=>addTxtFolderStructure(e,t)))}}function makeSortable(e){new Sortable(e,{group:{name:"nested",pull:!0,put:!0},animation:150,fallbackOnBody:!0,swapThreshold:.65,onAdd:function(e){const t=e.item;if(!t.classList.contains("file-item")){let e=t.querySelector(".nested");if(!e){e=document.createElement("div"),e.className="accordion-body nested";const r=t.querySelector(".accordion-collapse");r&&r.appendChild(e)}const r=t.closest(".accordion-item");if(r){const e=r.querySelector(".accordion-button");e&&(e.style.display="block")}}}})}function makeFileSortable(e){new Sortable(e,{group:{name:"nested",pull:!0,put:!0},animation:150,fallbackOnBody:!0,swapThreshold:.65,onAdd:function(e){const t=e.item;if(t.classList.contains("file-item")){const e=t.closest(".file-item");e&&e.appendChild(t)}}})}function saveConfig(e){localStorage.setItem("folderConfig",JSON.stringify(e))}function loadConfig(){clearStructure();const e=localStorage.getItem("folderConfig");e?JSON.parse(e).forEach((e=>addFolderStructure(e))):resetToDefaultStructure()}function saveDefaultStructure(){const e=getFolderStructure();localStorage.setItem("userDefaultStructure",JSON.stringify(e)),alert("Default structure saved!")}function resetToDefaultStructure(){clearStructure();parseStructure(document.getElementById("defaultStructureInput").value.split("\n")).forEach((e=>{e.name&&""!==e.name.trim()&&addFolderStructure(e)}))}function clearStructure(){const e=document.getElementById("folderStructure");for(;e.firstChild;)e.removeChild(e.firstChild)}function parseStructure(e){const t=[];let r=t;return e.forEach((e=>{const n=(e.match(/-/g)||[]).length,l=e.replace(/-/g,"").trim();if(""===l)return;const o=l.includes("[File:"),d={name:o?l.split(" [File:")[0].trim():l,path:o?l.split(" [File:")[1].replace("]","").trim():null,subFolders:[]};if(1===n)t.push(d),r=d.subFolders;else{let e=t;for(let t=1;t<n;t++)e=e[e.length-1].subFolders;e.push(d),r=d.subFolders}})),t}function addFile({directoryPath:e,fileName:t},r=null){const n=r||document.getElementById("folderStructure"),l=`file-${Date.now()}-${folderCounter++}`,o=document.createElement("div");return o.className="file-item",o.id=l,o.draggable=!0,o.innerHTML=`\n        üìÑ <span class="file-name">${t}</span>\n    `,o.dataset.filePath=`${e}\\${t}`,o.querySelector(".file-name").addEventListener("dragstart",(e=>{e.preventDefault()})),n.appendChild(o),makeFileSortable(o),o}document.getElementById("exportFile").addEventListener("click",exportToFile),document.getElementById("browseFolder").addEventListener("click",(()=>{window.api.send("browse-folder")})),document.getElementById("saveDefault").addEventListener("click",saveDefaultStructure),document.getElementById("resetStructure").addEventListener("click",resetToDefaultStructure),window.api.on("folder-selected",(e=>{document.getElementById("selectedFolder").value=e,document.getElementById("createFolders").disabled=!1,document.getElementById("createFolders").dataset.path=e,loadConfig()})),document.getElementById("createFolders").addEventListener("click",(()=>{const e=document.getElementById("createFolders").dataset.path,t=getFolderStructure();saveConfig(t),window.api.send("create-folders",{path:e,folderStructure:t})})),document.getElementById("addFolder").addEventListener("click",(()=>addFolder("New Folder"))),document.getElementById("addFile").addEventListener("click",(()=>{window.api.send("browse-file")})),window.api.on("file-selected",(({directoryPath:e,fileName:t})=>{addFile({directoryPath:e,fileName:t}),window.electron.sendFilePath({directoryPath:e,fileName:t})})),window.addEventListener("DOMContentLoaded",(()=>{makeSortable(document.getElementById("folderStructure")),loadConfig()}));const trashBin=document.getElementById("trashBin");function clearAll(){clearStructure(),saveConfig([])}function parseTxtStructure(e){const t=[];let r=t;return e.forEach((e=>{const n=(e.match(/-/g)||[]).length,l=e.replace(/-/g,"").trim();if(""===l)return;const o=l.includes("[File:"),d={name:o?l.split(" [File:")[0].trim():l,path:o?l.split(" [File:")[1].replace("]","").trim():null,subFolders:[]};if(1===n)t.push(d),r=d.subFolders;else{let e=t;for(let t=1;t<n;t++)e=e[e.length-1].subFolders;e.push(d),r=d.subFolders}})),t}function addTxtFolderStructure(e,t=null){const r=t?t.querySelector(".nested"):document.getElementById("folderStructure");if(r)if(e.path){addFile({directoryPath:e.path.substring(0,e.path.lastIndexOf("\\")),fileName:e.path.substring(e.path.lastIndexOf("\\")+1)},r)}else{const t=addFolder(e.name,r);e.subFolders.forEach((e=>addTxtFolderStructure(e,t)))}}function observeFolderStructure(){const e=document.getElementById("folderStructure");new MutationObserver((()=>{saveConfig(getFolderStructure())})).observe(e,{childList:!0,subtree:!0,attributes:!0})}new Sortable(trashBin,{group:{name:"nested",pull:!1,put:!0},onAdd:function(e){const t=e.item;trashBin.contains(t)&&t.parentElement.removeChild(t)}}),document.getElementById("clearAll").addEventListener("click",clearAll),document.getElementById("loadFile").addEventListener("change",(e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{const t=parseTxtStructure(e.target.result.split("\n"));clearStructure(),t.forEach((e=>addTxtFolderStructure(e)))},e.readAsText(t)}})),window.addEventListener("DOMContentLoaded",(()=>{makeSortable(document.getElementById("folderStructure")),loadConfig(),observeFolderStructure()}));